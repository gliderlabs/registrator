<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic|Vollkorn:400,700' rel='stylesheet' type='text/css'>
        
        
        <link rel="canonical" href="https://gliderlabs.com/registrator/user/backends/">
        <link rel="shortcut icon" href="../../img/favicon.ico">

	<title>Registry Backends - Registrator</title>

        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.4.0.min.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">
        <link href="../../css/base.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-58928488-1', 'auto');
            ga('send', 'pageview');
        </script>
        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <!-- Main title -->
            <a class="navbar-brand" href="../..">Registrator</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            <!-- Main navigation -->
            <ul class="nav navbar-nav">
            
            
                <li >
                    <a href="../..">Readme</a>
                </li>
            
            
            
                <li class="dropdown active">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">User Guide <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../quickstart/">Quickstart</a>
                        </li>
                    
                        <li >
                            <a href="../run/">Run Reference</a>
                        </li>
                    
                        <li >
                            <a href="../services/">Service Model</a>
                        </li>
                    
                        <li class="active">
                            <a href="./">Registry Backends</a>
                        </li>
                    
                        <li >
                            <a href="../faq/">FAQ</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Developer Guide <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../../dev/backends/">Contributing Backends</a>
                        </li>
                    
                        <li >
                            <a href="../../dev/releases/">Staging Releases</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            </ul>

            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                <!--li >
                    <a rel="next" href="../services/">
                        <i class="fa fa-arrow-left"></i> Previous
                    </a>
                </li>
                <li >
                    <a rel="prev" href="../faq/">
                        Next <i class="fa fa-arrow-right"></i>
                    </a>
                </li-->
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Versions <b class="caret"></b></a>
                    <ul class="dropdown-menu" id="versions-dropdown">
                    </ul>
                </li>
                <li>
                    <a href="http://glider-slackin.herokuapp.com/">
                        <i class="fa fa-slack"></i>
                        Community
                    </a>
                </li>
                
                <li>
                    <a href="https://github.com/gliderlabs/registrator">
                        
                            <i class="fa fa-github"></i>
                        
                        GitHub
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#backend-reference">Backend Reference</a></li>
        
            <li><a href="#consul">Consul</a></li>
        
            <li><a href="#consul-kv">Consul KV</a></li>
        
            <li><a href="#etcd">Etcd</a></li>
        
            <li><a href="#skydns-2">SkyDNS 2</a></li>
        
            <li><a href="#zookeeper-store">Zookeeper Store</a></li>
        
    
    </ul>
</div></div>
            <div class="col-md-8 content" role="main">

<h1 id="backend-reference">Backend Reference</h1>
<p>Registrator supports a number of backing registries. In order for Registrator to
be useful, you need to be running one of these. Below are the Registry URIs to
use for supported backends and documentation specific to their features.</p>
<p>See also <a href="../../dev/backends/">Contributing Backends</a>.</p>
<h2 id="consul">Consul</h2>
<pre><code>consul://&lt;address&gt;:&lt;port&gt;
consul-unix://&lt;filepath&gt;
consul-tls://&lt;address&gt;:&lt;port&gt;
</code></pre>
<p>Consul is the recommended registry since it specifically models services for
service discovery with health checks.</p>
<p>If no address and port is specified, it will default to <code>127.0.0.1:8500</code>.</p>
<p>Consul supports tags but no arbitrary service attributes.</p>
<p>When using the <code>consul-tls</code> scheme, registrator communicates with Consul through TLS. You must set the following environment variables:
 * <code>CONSUL_CACERT</code> : CA file location
 * <code>CONSUL_TLSCERT</code> : Certificate file location
 * <code>CONSUL_TLSKEY</code> : Key location</p>
<h3 id="consul-http-check">Consul HTTP Check</h3>
<p>This feature is only available when using Consul 0.5 or newer. Containers
specifying these extra metadata in labels or environment will be used to
register an HTTP health check with the service.</p>
<pre><code class="bash">SERVICE_80_CHECK_HTTP=/health/endpoint/path
SERVICE_80_CHECK_INTERVAL=15s
SERVICE_80_CHECK_TIMEOUT=1s     # optional, Consul default used otherwise
</code></pre>

<p>It works for services on any port, not just 80. If its the only service,
you can also use <code>SERVICE_CHECK_HTTP</code>.</p>
<h3 id="consul-tcp-check">Consul TCP Check</h3>
<p>This feature is only available when using Consul 0.6 or newer. Containers
specifying these extra metadata in labels or environment will be used to
register an TCP health check with the service.</p>
<pre><code class="bash">SERVICE_443_CHECK_TCP=true
SERVICE_443_CHECK_INTERVAL=15s
SERVICE_443_CHECK_TIMEOUT=3s        # optional, Consul default used otherwise
</code></pre>

<h3 id="consul-script-check">Consul Script Check</h3>
<p>This feature is tricky because it lets you specify a script check to run from
Consul. If running Consul in a container, you're limited to what you can run
from that container. For example, curl must be installed for this to work:</p>
<pre><code class="bash">SERVICE_CHECK_SCRIPT=curl --silent --fail example.com
</code></pre>

<p>The default interval for any non-TTL check is 10s, but you can set it with
<code>_CHECK_INTERVAL</code>. The check command will be interpolated with the <code>$SERVICE_IP</code>
and <code>$SERVICE_PORT</code> placeholders:</p>
<pre><code class="bash">SERVICE_CHECK_SCRIPT=nc $SERVICE_IP $SERVICE_PORT | grep OK
</code></pre>

<h3 id="consul-ttl-check">Consul TTL Check</h3>
<p>You can also register a TTL check with Consul. Keep in mind, this means Consul
will expect a regular heartbeat ping to its API to keep the service marked
healthy.</p>
<pre><code class="bash">SERVICE_CHECK_TTL=30s
</code></pre>

<h2 id="consul-kv">Consul KV</h2>
<pre><code>consulkv://&lt;address&gt;:&lt;port&gt;/&lt;prefix&gt;
consulkv-unix://&lt;filepath&gt;:/&lt;prefix&gt;
</code></pre>
<p>This is a separate backend to use Consul's key-value store instead of its native
service catalog. This behaves more like etcd since it has similar semantics, but
currently doesn't support TTLs.</p>
<p>If no address and port is specified, it will default to <code>127.0.0.1:8500</code>.</p>
<p>Using the prefix from the Registry URI, service definitions are stored as:</p>
<pre><code>&lt;prefix&gt;/&lt;service-name&gt;/&lt;service-id&gt; = &lt;ip&gt;:&lt;port&gt;
</code></pre>
<h2 id="etcd">Etcd</h2>
<pre><code>etcd://&lt;address&gt;:&lt;port&gt;/&lt;prefix&gt;
</code></pre>
<p>Etcd works similar to Consul KV, except supports service TTLs. It also currently
doesn't support service attributes/tags.</p>
<p>If no address and port is specified, it will default to <code>127.0.0.1:2379</code>.</p>
<p>Using the prefix from the Registry URI, service definitions are stored as:</p>
<pre><code>&lt;prefix&gt;/&lt;service-name&gt;/&lt;service-id&gt; = &lt;ip&gt;:&lt;port&gt;
</code></pre>
<h2 id="skydns-2">SkyDNS 2</h2>
<pre><code>skydns2://&lt;address&gt;:&lt;port&gt;/&lt;domain&gt;
</code></pre>
<p>SkyDNS 2 uses etcd, so this backend writes service definitions in a format compatible with SkyDNS 2.
The path may not be omitted and must be a valid DNS domain for SkyDNS.</p>
<p>If no address and port is specified, it will default to <code>127.0.0.1:2379</code>.</p>
<p>Using a Registry URI with the domain <code>cluster.local</code>, service definitions are stored as:</p>
<pre><code>/skydns/local/cluster/&lt;service-name&gt;/&lt;service-id&gt; = {"host":"&lt;ip&gt;","port":&lt;port&gt;}
</code></pre>
<p>SkyDNS requires the service ID to be a valid DNS hostname, so this backend requires containers to
override service ID to a valid DNS name. Example:</p>
<pre><code>$ docker run -d --name redis-1 -e SERVICE_ID=redis-1 -p 6379:6379 redis
</code></pre>
<h2 id="zookeeper-store">Zookeeper Store</h2>
<p>The Zookeeper backend lets you publish ephemeral znodes into zookeeper. This mode is enabled by specifying a zookeeper path.  The zookeeper backend supports publishing a json znode body complete with defined service attributes/tags as well as the service name and container id. Example URIs:</p>
<pre><code>$ registrator zookeeper://zookeeper.host/basepath
$ registrator zookeeper://192.168.1.100:9999/basepath
</code></pre>
<p>Within the base path specified in the zookeeper URI, registrator will create the following path tree containing a JSON entry for the service:</p>
<pre><code>&lt;service-name&gt;/&lt;service-port&gt; = &lt;JSON&gt;
</code></pre>
<p>The JSON will contain all infromation about the published container service. As an example, the following container start:</p>
<pre><code> docker run -i -p 80 -e 'SERVICE_80_NAME=www' -t ubuntu:14.04 /bin/bash
</code></pre>
<p>Will result in the zookeeper path and JSON znode body:</p>
<pre><code>/basepath/www/80 = {"Name":"www","IP":"192.168.1.123","PublicPort":49153,"PrivatePort":80,"ContainerID":"9124853ff0d1","Tags":[],"Attrs":{}}
</code></pre></div>
        </div>

        <footer class="col-md-12">
            <hr>
            
            <center>Documentation built with <a href="https://gliderlabs.com/pagebuilder">Pagebuilder</a>.</center>
        </footer>

        <script src="../../js/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/highlight.pack.js"></script>
        <script src="../../js/base.js"></script>
        <script>
          $( document ).ready(function() {
              $.getJSON("https://gliderlabs.com/registrator/versions.json", function(data) {
                $("#versions-dropdown").append('<li><a href="https://gliderlabs.com/registrator/latest">latest ('+data.latest+')</a></li>');
                $.each(data.versions, function( index, value ) {
                  $("#versions-dropdown").append('<li><a href="https://gliderlabs.com/registrator/'+value+'">'+value+'</a></li>');
                });
              });
          });
        </script>
    </body>
</html>